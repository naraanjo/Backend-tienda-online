

-- ============================================================================
--  CREACIÓN DE TABLAS (Como NARANJO_ADMIN)
-- ============================================================================


-- Tabla PERSONA
CREATE TABLE PERSONA (
    ID              NUMBER(19, 0)       GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOMBRE_COMPLETO VARCHAR2(150 CHAR)  NOT NULL,
    EMAIL           VARCHAR2(100 CHAR)  NOT NULL UNIQUE,
    FECHA_REGISTRO  TIMESTAMP           DEFAULT CURRENT_TIMESTAMP
);

-- Tabla DATOS_FISCALES
CREATE TABLE DATOS_FISCALES (
    ID              NUMBER(19, 0)       GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NIF_CIF         VARCHAR2(20 CHAR)   NOT NULL,
    CALLE           VARCHAR2(150 CHAR)  NOT NULL,
    CIUDAD          VARCHAR2(100 CHAR)  NOT NULL,
    CODIGO_POSTAL   VARCHAR2(10 CHAR)   NOT NULL,
    TELEFONO        VARCHAR2(20 CHAR)   NOT NULL,
    PERSONA_ID      NUMBER(19, 0)       NOT NULL UNIQUE,
    CONSTRAINT FK_DF_PERSONA FOREIGN KEY (PERSONA_ID) REFERENCES PERSONA (ID) ON DELETE CASCADE
);

-- Tabla ARTICULO
CREATE TABLE ARTICULO (
    ID              NUMBER(19, 0)       GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOMBRE          VARCHAR2(100 CHAR)  NOT NULL,
    DESCRIPCION     CLOB                NOT NULL,
    PVP_ACTUAL      NUMBER(10, 2)       NOT NULL CHECK (PVP_ACTUAL >= 0),
    STOCK           NUMBER(10, 0)       DEFAULT 0 NOT NULL CHECK (STOCK >= 0)
);

-- Tabla COMPRA
-- Precio total es un campo calculado que no añado en la tabla
CREATE TABLE COMPRA (
    ID              NUMBER(19, 0)       GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    FECHA_COMPRA    TIMESTAMP           DEFAULT CURRENT_TIMESTAMP NOT NULL,
    ESTADO          VARCHAR2(20 CHAR)   NOT NULL CHECK (ESTADO IN ('PENDIENTE', 'ENVIADO', 'ENTREGADO', 'CANCELADO')),
    CALLE           VARCHAR2(150 CHAR)  NOT NULL,
    CIUDAD          VARCHAR2(100 CHAR)  NOT NULL,
    CODIGO_POSTAL   VARCHAR2(10 CHAR)   NOT NULL,
    PERSONA_ID      NUMBER(19, 0)       NOT NULL,
    CONSTRAINT FK_COMPRA_PERSONA FOREIGN KEY (PERSONA_ID) REFERENCES PERSONA (ID)
);

-- Tabla LINEA_COMPRA
CREATE TABLE LINEA_COMPRA (
    ID              NUMBER(19, 0)       GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CANTIDAD        NUMBER(5, 0)        NOT NULL CHECK (CANTIDAD > 0),
    PRECIO_SNAPSHOT NUMBER(10, 2)       NOT NULL CHECK (PRECIO_SNAPSHOT >= 0),
    COMPRA_ID       NUMBER(19, 0)       NOT NULL,
    ARTICULO_ID     NUMBER(19, 0)       NOT NULL,
    CONSTRAINT FK_LINEA_COMPRA FOREIGN KEY (COMPRA_ID) REFERENCES COMPRA (ID),
    CONSTRAINT FK_LINEA_ARTICULO FOREIGN KEY (ARTICULO_ID) REFERENCES ARTICULO (ID)
);

